<!DOCTYPE html>
<html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes"><title>lokus hub scripts</title><style>/*! MOBILE FRIENDLY WITH KEY SYSTEM */
*{box-sizing:border-box;margin:0;-webkit-tap-highlight-color:transparent}body{margin:0;padding:16px;background:#0b0b0b;color:#eaeaea;font-family:'Courier New',Courier,monospace;min-height:100vh;display:flex;flex-direction:column;align-items:center;position:relative}@media (max-width:480px){body{padding:12px}}.container{max-width:720px;width:100%;position:relative;z-index:1}h1{font-size:1.8rem;font-weight:400;letter-spacing:-.5px;margin:0 0 .5rem;color:#00f2ea;border-left:4px solid #00f2ea;padding-left:16px;min-height:70px}@media (max-width:480px){h1{font-size:1.5rem;padding-left:12px;min-height:60px}}.cursor{display:inline-block;width:3px;margin-left:4px;background:#00f2ea;animation:blink 1s infinite}@keyframes blink{0%,50%{opacity:1}51%,100%{opacity:0}}.subhead{font-size:.9rem;color:#aaa;margin-bottom:2rem;font-family:monospace;border-bottom:1px solid #2a2a2a;padding-bottom:.75rem;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px}@media (max-width:480px){.subhead{font-size:.8rem;margin-bottom:1.5rem}}.music-indicator{font-size:.7rem;background:#1a1a1a;padding:8px 16px;border-radius:40px;color:#00f2ea;border:1px solid #2e2e2e;letter-spacing:.5px;display:flex;align-items:center;gap:8px;cursor:pointer;transition:all .2s;min-height:44px;min-width:44px;justify-content:center}@media (max-width:480px){.music-indicator{padding:10px 16px;font-size:.8rem}}.music-indicator:active{background:#2a2a2a;transform:scale(0.98)}.music-indicator.playing{color:#00f2ea;animation:pulse 2s infinite}@keyframes pulse{0%{opacity:1}50%{opacity:.7}100%{opacity:1}}.visitor-badge{background:#1a1a2e;border:1px solid #00f2ea40;border-radius:40px;padding:8px 18px;font-size:.8rem;color:#00f2ea;display:flex;align-items:center;gap:8px}.visitor-badge span{font-weight:bold;color:white;margin-left:4px}.last-updated{background:#1a2a2a;border-radius:30px;padding:8px 16px;font-size:.8rem;color:#9cfff8;display:inline-flex;align-items:center;gap:8px;margin-bottom:15px;border:1px solid #00f2ea40}.last-updated span{color:#00f2ea;font-weight:bold}.discord-stats-card{background:linear-gradient(145deg,#1a1f2e,#0f1219);border:2px solid #5865F2;border-radius:24px;padding:20px;margin:25px 0 20px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:15px;box-shadow:0 10px 0 #2c2f3a,0 0 20px #5865F240;cursor:pointer;transition:all .2s}.discord-stats-card:active{transform:translateY(-2px);box-shadow:0 12px 0 #2c2f3a,0 0 25px #5865F2}.discord-info{display:flex;align-items:center;gap:15px;flex-wrap:wrap}.discord-icon{font-size:2.5rem;background:#5865F2;width:60px;height:60px;border-radius:30px;display:flex;align-items:center;justify-content:center;color:white;box-shadow:0 5px 0 #3b4b9e}.discord-text h3{color:white;font-size:1.2rem;margin-bottom:4px}.discord-text p{color:#aab8e0;font-size:.85rem}.discord-stats{display:flex;gap:25px;background:#0b0e14;padding:12px 25px;border-radius:50px;border:1px solid #404a6b}.stat-item{text-align:center}.stat-value{font-size:1.6rem;font-weight:700;color:#00f2ea;line-height:1}.stat-label{font-size:.7rem;color:#8895c7;text-transform:uppercase;letter-spacing:1px}@media (max-width:500px){.discord-stats-card{flex-direction:column;align-items:flex-start}.discord-stats{align-self:stretch;justify-content:space-around}}.faq-section{background:#111;border-radius:20px;padding:20px;margin:30px 0 20px;border:1px solid #2a2a2a}.faq-section h3{color:#00f2ea;font-size:1.2rem;margin-bottom:20px;display:flex;align-items:center;gap:8px}.faq-item{border-bottom:1px solid #2a2a2a;margin-bottom:15px;padding-bottom:15px}.faq-item:last-child{border-bottom:none;margin-bottom:0;padding-bottom:0}.faq-question{font-weight:bold;color:white;margin-bottom:8px;display:flex;align-items:center;gap:8px}.faq-question:before{content:"‚ùì";color:#00f2ea}.faq-answer{color:#aaa;font-size:.9rem;padding-left:28px;line-height:1.5}h2{font-size:1.25rem;margin:2rem 0 .75rem;color:#00f2ea;font-weight:500;display:flex;align-items:center;gap:6px;border-bottom:1px dashed #2e2e2e;padding-bottom:4px}@media (max-width:480px){h2{font-size:1.1rem;margin:1.5rem 0 .5rem}}.script-card{background:#111;border-radius:20px;padding:16px 18px;margin:16px 0;border:1px solid #242424;box-shadow:0 8px 0 #050505;transition:.1s ease;position:relative}@media (max-width:480px){.script-card{padding:14px;border-radius:16px;margin:12px 0}}.script-card.blurred{position:relative;cursor:pointer}.script-card.blurred>:not(.script-label):not(.feature-tags){filter:blur(5px);pointer-events:none;user-select:none}.script-card.blurred .script-label span,.script-card.blurred .feature-tags{filter:none;pointer-events:none}.script-card.blurred::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:transparent;z-index:5;pointer-events:none}.script-card.blurred::after{content:"üîí VERIFY TO UNLOCK";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:#00f2ea;color:#000;padding:16px 28px;border-radius:50px;font-weight:700;font-size:1.1rem;z-index:15;border:2px solid #4afff0;box-shadow:0 0 20px #00f2ea;animation:glow 1.5s infinite;cursor:pointer;pointer-events:auto;white-space:nowrap;min-width:200px;text-align:center}@media (max-width:480px){.script-card.blurred::after{padding:14px 20px;font-size:1rem;min-width:160px;white-space:normal}}.script-card.blurred:active::after{transform:translate(-50%,-50%) scale(0.97)}@keyframes glow{0%{box-shadow:0 0 10px #00f2ea}50%{box-shadow:0 0 25px #00f2ea}100%{box-shadow:0 0 10px #00f2ea}}.script-label{font-size:.7rem;text-transform:uppercase;color:#777;letter-spacing:1px;margin-bottom:8px;display:flex;align-items:center;gap:5px;flex-wrap:wrap}.script-label span{background:#00f2ea20;color:#9cfff8;padding:4px 12px;border-radius:30px;font-size:.7rem}@media (max-width:480px){.script-label span{padding:6px 12px}}.feature-tags{display:flex;flex-wrap:wrap;gap:8px;margin:12px 0;padding:4px 0;position:relative;z-index:2}.feature-tag{background:#1a2a2a;color:#9cfff8;padding:8px 16px;border-radius:40px;font-size:.75rem;font-weight:700;border:1px solid #00f2ea40;letter-spacing:.5px;transition:all .2s;min-height:40px;display:flex;align-items:center;justify-content:center}@media (max-width:480px){.feature-tag{padding:8px 12px;font-size:.7rem;min-height:36px}}.feature-tag:active{background:#00f2ea20;border-color:#00f2ea;transform:translateY(-2px)}.feature-tag.bloxfruit{border-color:#ff6b6b}.feature-tag.brainrot{border-color:#a78bfa}.feature-tag.tsunami{border-color:#60a5fa}.feature-tag.rivals{border-color:#f87171}.feature-tag.arsenal{border-color:#fbbf24}.feature-tag.fisch{border-color:#34d399}.feature-tag.adoptme{border-color:#f472b6}.feature-tag.garden{border-color:#4ade80}.key-badge{display:inline-block;padding:4px 12px;border-radius:30px;font-size:.7rem;font-weight:bold;margin-right:5px}.key-badge.keyless{background:#4a4a4a;color:#fff}.key-badge.key1{background:#00aa00;color:#fff}.key-badge.key2{background:#ffaa00;color:#000}.key-badge.key3{background:#ff4444;color:#fff}.key-button{background:#ff6600;color:white;border:none;padding:10px 20px;border-radius:50px;font-size:.9rem;font-weight:bold;cursor:pointer;margin:10px 0;width:100%;transition:all .2s}.key-button:hover{background:#ff8800;transform:scale(1.02)}.key-button.completed{background:#00aa00;pointer-events:none}.key-status{display:flex;gap:10px;margin:10px 0;flex-wrap:wrap;justify-content:center}.key-dot{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:1.1rem}.key-dot.pending{background:#444;color:#fff}.key-dot.completed{background:#00aa00;color:#fff}pre{background:#0c0c0c;padding:16px;border-radius:16px;overflow-x:auto;font-size:.8rem;line-height:1.5;color:#c5fffb;font-family:'Courier New',Courier,monospace;border:1px solid #2e2e2e;margin:10px 0 16px;white-space:pre-wrap;word-wrap:break-word;-webkit-overflow-scrolling:touch}@media (max-width:480px){pre{padding:14px;font-size:.75rem}}.copy-btn{background:#00f2ea;border:none;color:#000;font-family:inherit;font-weight:600;font-size:1rem;padding:16px 20px;border-radius:50px;width:100%;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:12px;transition:.15s;border:1px solid #4afff0;letter-spacing:.3px;min-height:56px}@media (max-width:480px){.copy-btn{padding:16px;font-size:.95rem;min-height:52px}}.copy-btn:active{background:#00d4cc;transform:scale(0.99)}.social-grid{display:flex;flex-direction:column;gap:12px;margin:20px 0 16px}.social-link{display:flex;align-items:center;justify-content:center;background:#111;padding:16px 20px;border-radius:50px;text-decoration:none;color:#eaeaea;font-weight:600;font-size:1.1rem;border:1px solid #2c2c2c;transition:.12s;gap:12px;backdrop-filter:blur(4px);min-height:56px}@media (max-width:480px){.social-link{padding:16px;font-size:1rem;min-height:52px}}.social-link:active{background:#1f1f1f;border-color:#00f2ea;color:#fff;transform:translateY(-2px)}.social-icon{font-size:1.5rem}.note{margin-top:36px;font-size:.7rem;color:#5f5f5f;text-align:center;border-top:1px solid #202020;padding-top:24px;font-family:monospace}#bg-music{display:none}.modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.95);backdrop-filter:blur(10px);display:none;justify-content:center;align-items:center;z-index:1000;padding:16px}.modal-overlay.active{display:flex}.modal-content{background:#111;border:2px solid #00f2ea;border-radius:32px;padding:32px 24px;max-width:400px;width:100%;text-align:center;box-shadow:0 0 40px #00f2ea33;animation:modalPop .3s ease}@media (max-width:480px){.modal-content{padding:28px 20px;border-radius:28px}}@keyframes modalPop{0%{transform:scale(.9);opacity:0}100%{transform:scale(1);opacity:1}}.modal-icon{font-size:56px;margin-bottom:16px}.modal-title{font-size:28px;font-weight:700;color:#00f2ea;margin-bottom:16px}@media (max-width:480px){.modal-title{font-size:24px}}.modal-text{color:#ccc;margin-bottom:24px;line-height:1.5;font-size:1rem}.redirect-timer{font-size:18px;color:#00f2ea;margin:24px 0 16px;font-weight:700}.timer-bar{width:100%;height:8px;background:#333;border-radius:10px;overflow:hidden;margin:16px 0}.timer-progress{height:100%;background:#00f2ea;width:100%;transition:width 1s linear}.modal-close{margin-top:24px;color:#888;cursor:pointer;font-size:16px;padding:12px;display:inline-block}.modal-close:active{color:#00f2ea}.toast{position:fixed;bottom:30px;left:50%;transform:translateX(-50%);background:#00f2ea;color:#000;padding:12px 30px;border-radius:50px;font-weight:bold;z-index:9999;display:none;box-shadow:0 5px 20px #00f2ea66}.toast.show{display:block;animation:slideUp 0.3s, fadeOut 0.3s 2s forwards}@keyframes slideUp{from{bottom:-50px;opacity:0}to{bottom:30px;opacity:1}}@keyframes fadeOut{to{opacity:0}}</style></head><body><div class="container"><h1 id="typingTitle"></h1><div class="subhead"><span>// scripts that work ‚ú¶</span><div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap"><span class="visitor-badge" id="visitorBadge">üëÅÔ∏è <span id="visitorCount">0</span> today ¬∑ <span id="totalVisits">0</span> total</span><span class="music-indicator" id="musicIndicator" onclick="toggleMusic()"><span>üîä</span> music</span></div></div>

<!-- LAST UPDATED TIMESTAMP -->
<div class="last-updated" id="lastUpdated">
  <span>üïí</span> Last updated: <span id="updateDate">Loading...</span>
</div>

<audio id="bg-music" loop preload="auto"><source src="https://files.catbox.moe/71lr1s.mp3" type="audio/mpeg"></audio>

<!-- DISCORD LIVE MEMBER CARD (CLICKABLE) -->
<div class="discord-stats-card" onclick="window.open('https://dsc.gg/lokus-hub', '_blank')">
  <div class="discord-info">
    <div class="discord-icon">üí¨</div>
    <div class="discord-text">
      <h3>Join Discord</h3>
      <p id="discordServerName">lokus hub community</p>
    </div>
  </div>
  <div class="discord-stats">
    <div class="stat-item">
      <div class="stat-value" id="onlineCount">--</div>
      <div class="stat-label">ONLINE</div>
    </div>
    <div class="stat-item">
      <div class="stat-value" id="totalMembers">‚ö°</div>
      <div class="stat-label">LIVE</div>
    </div>
  </div>
</div>

<!-- SCRIPTS WILL BE LOADED HERE FROM JSON -->
<div class="flex-scripts" id="scriptsContainer">
  <p style="color: #666; text-align: center;">Loading scripts...</p>
</div>

<!-- FAQ SECTION -->
<div class="faq-section">
  <h3>‚ùì Frequently Asked Questions</h3>
  
  <div class="faq-item">
    <div class="faq-question">How do I use these scripts?</div>
    <div class="faq-answer">Copy the script and paste it into your Roblox executor (like Krnl, Synapse, or Fluxus). Execute while in the game.</div>
  </div>
  
  <div class="faq-item">
    <div class="faq-question">Are these scripts safe?</div>
    <div class="faq-answer">Yes, all scripts are tested and safe to use. We recommend using alts for protection.</div>
  </div>
  
  <div class="faq-item">
    <div class="faq-question">Why is the universal script blurred?</div>
    <div class="faq-answer">You need to verify through our partner link to unlock premium scripts. This prevents abuse and alt accounts.</div>
  </div>
  
  <div class="faq-item">
    <div class="faq-question">How often are scripts updated?</div>
    <div class="faq-answer">Scripts are updated daily to ensure they work with the latest game patches.</div>
  </div>
  
  <div class="faq-item">
    <div class="faq-question">Need help or found a bug?</div>
    <div class="faq-answer">Join our Discord server and ask in the support channel!</div>
  </div>
</div>

<h2>üåê socials</h2><div class="social-grid"><a href="https://dsc.gg/lokus-hub" target="_blank" class="social-link"><span class="social-icon">üí¨</span> discord</a><a href="https://www.tiktok.com/@growagardenxaweso" target="_blank" class="social-link"><span class="social-icon">üéµ</span> tiktok</a><a href="https://www.youtube.com/@drippyguygaming" target="_blank" class="social-link"><span class="social-icon">‚ñ∂Ô∏è</span> youtube</a></div><div class="note">‚ú¶ lokus hub scripts ‚Äî updated daily ‚ú¶<br>blur permanent ¬∑ MP3 ¬∑ mobile friendly</div></div>

<!-- COPY TOAST NOTIFICATION -->
<div class="toast" id="copyToast">üìã Script copied!</div>

<!-- BLOXLINK REDIRECT MODAL (FOR UNIVERSAL SCRIPT) -->
<div class="modal-overlay" id="redirectModal" onclick="closeRedirectModalIfOverlay(event)">
  <div class="modal-content">
    <div class="modal-icon">‚è≥</div>
    <div class="modal-title">Verification Required</div>
    <div class="modal-text" id="redirectModalText">Please wait 5 seconds to be redirected to Bloxlink...</div>
    <div class="redirect-timer" id="redirectTimerText">5 seconds</div>
    <div class="timer-bar">
      <div class="timer-progress" id="redirectTimerProgress" style="width:100%"></div>
    </div>
    <div class="modal-close" onclick="closeRedirectModal()">‚úï cancel</div>
  </div>
</div>

<!-- CUSTOM REDIRECT MODAL FOR OTHER BLURRED SCRIPTS (USES URL FROM ADMIN) -->
<div class="modal-overlay" id="customRedirectModal" onclick="closeCustomRedirectModalIfOverlay(event)">
  <div class="modal-content">
    <div class="modal-icon">‚è≥</div>
    <div class="modal-title">Verification Required</div>
    <div class="modal-text" id="customRedirectModalText">Please wait 5 seconds to continue...</div>
    <div class="redirect-timer" id="customRedirectTimerText">5 seconds</div>
    <div class="timer-bar">
      <div class="timer-progress" id="customRedirectTimerProgress" style="width:100%"></div>
    </div>
    <div class="modal-close" onclick="closeCustomRedirectModal()">‚úï cancel</div>
  </div>
</div>

<!-- KEY VERIFICATION MODAL -->
<div class="modal-overlay" id="keyModal" onclick="closeKeyModalIfOverlay(event)">
  <div class="modal-content" style="max-width:500px;">
    <div class="modal-icon">üîë</div>
    <div class="modal-title" id="keyModalTitle">Key Required</div>
    <div class="modal-text" id="keyModalText">Complete Linkvertise ads to unlock this script</div>
    <div id="keyStatus" class="key-status" style="margin:20px 0;"></div>
    <div id="keyButtons"></div>
    <div class="modal-close" onclick="closeKeyModal()">‚úï close</div>
  </div>
</div>

<!-- OLD VERIFICATION MODAL (KEPT FOR COMPATIBILITY) -->
<div class="modal-overlay" id="verificationModal" onclick="closeModalIfOverlay(event)"><div class="modal-content"><div class="modal-icon">üîí</div><div class="modal-title">Verify</div><div class="modal-text">Connect Discord (keyless)</div><div style="font-size:.8rem;color:#ff8888;margin-bottom:20px">Bot / Alt Not allowed</div><div id="redirectSection"><div class="redirect-timer" id="timerText">5s...</div><div class="timer-bar"><div class="timer-progress" id="timerProgress" style="width:100%"></div></div></div><div class="modal-close" onclick="closeModal()">‚úï close</div></div></div>

<script>
// ==================== ENHANCED VISITOR COUNTER ====================
let totalVisits = localStorage.getItem('totalVisits');
if (totalVisits === null) {
  totalVisits = 1;
} else {
  totalVisits = parseInt(totalVisits) + 1;
}
localStorage.setItem('totalVisits', totalVisits);

let today = new Date().toDateString();
let lastVisit = localStorage.getItem('lastVisit');
let dailyVisits = localStorage.getItem('dailyVisits');

if (lastVisit !== today) {
  dailyVisits = 1;
  localStorage.setItem('lastVisit', today);
} else {
  dailyVisits = parseInt(dailyVisits || 0) + 1;
}
localStorage.setItem('dailyVisits', dailyVisits);

document.getElementById('visitorCount').textContent = dailyVisits;
document.getElementById('totalVisits').textContent = totalVisits;

// ==================== BLOXLINK REDIRECT (FOR UNIVERSAL SCRIPT) ====================
let redirectTimer = null;
const redirectModal = document.getElementById('redirectModal');
const redirectTimerText = document.getElementById('redirectTimerText');
const redirectTimerProgress = document.getElementById('redirectTimerProgress');

function showRedirectToBloxlink() {
  redirectModal.classList.add('active');
  redirectTimerProgress.style.width = '100%';
  
  let timeLeft = 5;
  redirectTimerText.textContent = timeLeft + ' seconds';
  
  const interval = setInterval(() => {
    timeLeft--;
    redirectTimerText.textContent = timeLeft + ' seconds';
    redirectTimerProgress.style.width = (timeLeft / 5) * 100 + '%';
    
    if (timeLeft <= 0) {
      clearInterval(interval);
      window.location.href = '/lokus-hub/bloxlink.html';
      closeRedirectModal();
    }
  }, 1000);
  
  redirectTimer = interval;
}

function closeRedirectModal() {
  redirectModal.classList.remove('active');
  if (redirectTimer) {
    clearInterval(redirectTimer);
    redirectTimer = null;
  }
}

function closeRedirectModalIfOverlay(e) {
  if (e.target === redirectModal) {
    closeRedirectModal();
  }
}

// ==================== CUSTOM REDIRECT FOR OTHER BLURRED SCRIPTS ====================
let customRedirectTimer = null;
const customRedirectModal = document.getElementById('customRedirectModal');
const customRedirectTimerText = document.getElementById('customRedirectTimerText');
const customRedirectTimerProgress = document.getElementById('customRedirectTimerProgress');

function showCustomRedirect(redirectUrl) {
  customRedirectModal.classList.add('active');
  customRedirectTimerProgress.style.width = '100%';
  
  let timeLeft = 5;
  customRedirectTimerText.textContent = timeLeft + ' seconds';
  
  const interval = setInterval(() => {
    timeLeft--;
    customRedirectTimerText.textContent = timeLeft + ' seconds';
    customRedirectTimerProgress.style.width = (timeLeft / 5) * 100 + '%';
    
    if (timeLeft <= 0) {
      clearInterval(interval);
      window.location.href = redirectUrl; // Uses the URL from admin panel
      closeCustomRedirectModal();
    }
  }, 1000);
  
  customRedirectTimer = interval;
}

function closeCustomRedirectModal() {
  customRedirectModal.classList.remove('active');
  if (customRedirectTimer) {
    clearInterval(customRedirectTimer);
    customRedirectTimer = null;
  }
}

function closeCustomRedirectModalIfOverlay(e) {
  if (e.target === customRedirectModal) {
    closeCustomRedirectModal();
  }
}

// ==================== LINKVERTISE BACKEND CONNECTION ====================
const BACKEND_URL = 'https://linkvertise-callback-production.up.railway.app';

// ==================== KEY SYSTEM STATE ====================
let currentScriptKeyData = null;
let completedKeys = JSON.parse(localStorage.getItem('completedKeys') || '{}');

// Generate or get user ID
function getUserId() {
  let userId = localStorage.getItem('linkvertise_user_id');
  if (!userId) {
    userId = 'user_' + Math.random().toString(36).substring(2) + '_' + Date.now();
    localStorage.setItem('linkvertise_user_id', userId);
  }
  return userId;
}

// ==================== TOAST FUNCTION ====================
function showToast(message) {
  const toast = document.getElementById('copyToast');
  toast.textContent = message;
  toast.classList.add('show');
  setTimeout(() => {
    toast.classList.remove('show');
  }, 2500);
}

// ==================== CHECK URL FOR COMPLETION ====================
function checkUrlForCompletion() {
  const urlParams = new URLSearchParams(window.location.search);
  
  if (urlParams.get('completed') === '1') {
    const keyIndex = urlParams.get('key');
    const scriptId = urlParams.get('script');
    const userId = urlParams.get('user') || getUserId();
    
    console.log('üéØ Completion detected:', { keyIndex, scriptId, userId });
    
    showToast('‚úÖ Key completed! Refreshing status...');
    
    setTimeout(async () => {
      window.history.replaceState({}, document.title, window.location.pathname);
      await refreshKeyStatus(userId, scriptId);
      await loadScriptsFromJSON();
      
      if (currentScriptKeyData) {
        openKeyModal(currentScriptKeyData.id);
      }
    }, 2000);
  }
}

// ==================== REFRESH KEY STATUS FROM BACKEND ====================
async function refreshKeyStatus(userId, scriptId) {
  try {
    const response = await fetch(`${BACKEND_URL}/api/status/${userId}/${scriptId}`);
    if (response.ok) {
      const data = await response.json();
      console.log('üìä Backend status:', data);
      
      if (data.completedKeys && data.completedKeys.length > 0) {
        completedKeys[scriptId] = data.completedKeys;
        localStorage.setItem('completedKeys', JSON.stringify(completedKeys));
        return true;
      }
    }
  } catch (error) {
    console.error('‚ùå Status refresh error:', error);
  }
  return false;
}

// ==================== LOAD SCRIPTS FROM JSON ====================
async function loadScriptsFromJSON() {
  try {
    const response = await fetch('scripts.json?t=' + Date.now());
    const data = await response.json();
    
    if (data.lastUpdated) {
      document.getElementById('updateDate').textContent = data.lastUpdated;
    }
    
    const container = document.getElementById('scriptsContainer');
    if (!container) return;
    
    container.innerHTML = '';
    
    data.scripts.forEach(script => {
      const card = document.createElement('div');
      card.className = `script-card ${script.blurred ? 'blurred' : ''}`;
      card.id = `${script.id}-card`;
      
      if (script.blurred) {
        card.onclick = (e) => {
          if (!e.target.classList.contains('copy-btn')) {
            // UNIVERSAL SCRIPT - special case (goes to bloxlink.html)
            if (script.id === 'universal' || script.name.includes('UNIVERSAL')) {
              showRedirectToBloxlink();
            } 
            // OTHER BLURRED SCRIPTS - use the redirectUrl from admin panel
            else if (script.redirectUrl) {
              showCustomRedirect(script.redirectUrl); // Uses OpeninApp or any link set in admin
            } else {
              // Fallback if no redirect URL (shouldn't happen with admin validation)
              alert('This script needs a redirect URL configured in admin panel');
            }
          }
        };
      }
      
      let keyBadge = '';
      if (script.keySystem === 'keyless') keyBadge = '<span class="key-badge keyless">üîì KEYLESS</span>';
      else if (script.keySystem === 'key1') keyBadge = '<span class="key-badge key1">üîë 1 KEY</span>';
      else if (script.keySystem === 'key2') keyBadge = '<span class="key-badge key2">üîëüîë 2 KEYS</span>';
      else if (script.keySystem === 'key3') keyBadge = '<span class="key-badge key3">üîëüîëüîë 3 KEYS</span>';
      
      let featuresHTML = '';
      if (script.features && script.features.length > 0) {
        featuresHTML = '<div class="feature-tags">' + 
          script.features.map(f => `<span class="feature-tag">${f}</span>`).join('') + 
          '</div>';
      }
      
      const escapedCode = script.code.replace(/</g, '&lt;').replace(/>/g, '&gt;');
      
      let keyButton = '';
      if (script.keySystem !== 'keyless' && script.keySystem !== undefined) {
        const scriptCompleted = completedKeys[script.id] || [];
        const neededKeys = parseInt(script.keySystem.replace('key', ''));
        const allCompleted = scriptCompleted.length === neededKeys;
        
        keyButton = `
          <button class="key-button ${allCompleted ? 'completed' : ''}" 
                  onclick="openKeyModal('${script.id}')"
                  ${allCompleted ? 'disabled' : ''}>
            ${allCompleted ? '‚úÖ Unlocked' : 'üîë Get Keys (' + scriptCompleted.length + '/' + neededKeys + ')'}
          </button>
        `;
      }
      
      card.innerHTML = `
        <div class="script-label">
          <span>${script.name}</span>
          ${keyBadge}
        </div>
        ${featuresHTML}
        ${keyButton}
        <pre id="${script.id}">${escapedCode}</pre>
        <button class="copy-btn" onclick="copySpecific('${script.id}')">
          <span>üìã</span> copy script
        </button>
      `;
      
      container.appendChild(card);
    });
  } catch (error) {
    console.error('Failed to load scripts:', error);
    document.getElementById('scriptsContainer').innerHTML = 
      '<p style="color: #ff4444; text-align: center;">‚ùå Failed to load scripts.</p>';
  }
}

// ==================== KEY MODAL FUNCTIONS ====================
async function openKeyModal(scriptId) {
  try {
    const response = await fetch('scripts.json?t=' + Date.now());
    const data = await response.json();
    const script = data.scripts.find(s => s.id === scriptId);
    
    if (!script || !script.keyLinks) {
      alert('Script key links not found');
      return;
    }
    
    currentScriptKeyData = {
      id: scriptId,
      links: script.keyLinks,
      needed: script.keyLinks.length
    };
    
    const completed = completedKeys[scriptId] || [];
    
    document.getElementById('keyModalTitle').textContent = `üîë ${script.name}`;
    document.getElementById('keyModalText').textContent = 
      `Complete ${script.keyLinks.length} ads to unlock this script`;
    
    let statusHTML = '';
    for (let i = 0; i < script.keyLinks.length; i++) {
      const isCompleted = completed.includes(i);
      statusHTML += `<div class="key-dot ${isCompleted ? 'completed' : 'pending'}">${i+1}</div>`;
    }
    document.getElementById('keyStatus').innerHTML = statusHTML;
    
    let buttonsHTML = '';
    script.keyLinks.forEach((link, index) => {
      if (!completed.includes(index)) {
        buttonsHTML += `
          <button class="key-button" onclick="completeKey(${index}, '${link}')">
            Complete Key ${index+1}
          </button>
        `;
      }
    });
    
    if (buttonsHTML === '') {
      buttonsHTML = '<p style="color:#00f2ea; margin:20px;">‚úÖ All keys completed! You can now use the script.</p>';
    }
    
    document.getElementById('keyButtons').innerHTML = buttonsHTML;
    document.getElementById('keyModal').classList.add('active');
  } catch (error) {
    console.error('Error opening key modal:', error);
    alert('Failed to load key information');
  }
}

// ==================== COMPLETE KEY WITH LINKVERTISE ====================
async function completeKey(index, link) {
  const userId = getUserId();
  const scriptId = currentScriptKeyData.id;
  
  showToast('‚è≥ Generating link...');
  console.log('üéØ Starting key completion:', { userId, scriptId, index, link });
  
  try {
    const response = await fetch(`${BACKEND_URL}/api/get-linkvertise-link`, {
      method: 'POST',
      headers: { 
        'Content-Type': 'application/json',
        'Accept': 'application/json'
      },
      body: JSON.stringify({ 
        userId: userId, 
        scriptId: scriptId, 
        keyIndex: index 
      })
    });
    
    console.log('üì° Response status:', response.status);
    
    const data = await response.json();
    console.log('üì¶ Response data:', data);
    
    if (data.success && data.linkvertiseUrl) {
      window.open(data.linkvertiseUrl, '_blank');
      showToast('‚úÖ Complete the ad to unlock key...');
      
      let attempts = 0;
      const maxAttempts = 60;
      
      const checkInterval = setInterval(async () => {
        attempts++;
        console.log(`üîÑ Checking status attempt ${attempts}`);
        
        try {
          const statusResponse = await fetch(`${BACKEND_URL}/api/status/${userId}/${scriptId}`);
          const statusData = await statusResponse.json();
          
          console.log('üìä Status check result:', statusData);
          
          if (statusData.completedKeys && statusData.completedKeys.includes(index)) {
            clearInterval(checkInterval);
            
            if (!completedKeys[scriptId]) completedKeys[scriptId] = [];
            if (!completedKeys[scriptId].includes(index)) {
              completedKeys[scriptId].push(index);
              localStorage.setItem('completedKeys', JSON.stringify(completedKeys));
            }
            
            showToast(`‚úÖ Key ${index+1} completed!`);
            
            if (completedKeys[scriptId].length === currentScriptKeyData.needed) {
              showToast('üéâ All keys completed! Script unlocked.');
              closeKeyModal();
              loadScriptsFromJSON();
            } else {
              closeKeyModal();
              openKeyModal(scriptId);
            }
          }
          
          if (attempts >= maxAttempts) {
            clearInterval(checkInterval);
            showToast('‚è∞ Timeout - please refresh and check status');
          }
        } catch (error) {
          console.error('Status check error:', error);
        }
      }, 2000);
    } else {
      console.error('‚ùå Failed to generate link:', data);
      showToast('‚ùå Failed to generate link');
    }
  } catch (error) {
    console.error('‚ùå Error in completeKey:', error);
    showToast('‚ùå Error generating link');
  }
}

function closeKeyModal() {
  document.getElementById('keyModal').classList.remove('active');
  currentScriptKeyData = null;
}

function closeKeyModalIfOverlay(e) {
  if (e.target === document.getElementById('keyModal')) {
    closeKeyModal();
  }
}

// ==================== TYPING ANIMATION ====================
const titleElement = document.getElementById('typingTitle');
const fullTitle = "lokus hub scripts";
let i = 0;
let isDeleting = false;
let delay = 100;

function typeEffect() {
  if (!isDeleting && i <= fullTitle.length) {
    titleElement.innerHTML = fullTitle.substring(0, i) + '<span class="cursor">|</span>';
    i++;
    delay = 150;
  } else if (isDeleting && i >= 0) {
    titleElement.innerHTML = fullTitle.substring(0, i) + '<span class="cursor">|</span>';
    i--;
    delay = 50;
  }
  
  if (i > fullTitle.length) {
    isDeleting = true;
    delay = 2000;
    i = fullTitle.length;
  }
  
  if (i < 0) {
    isDeleting = false;
    delay = 500;
    i = 0;
  }
  
  setTimeout(typeEffect, delay);
}

// ==================== ANTI-DEBUG ====================
document.addEventListener('contextmenu', e => e.preventDefault());
document.addEventListener('keydown', e => {
  if (e.key === 'F12' || (e.ctrlKey && e.shiftKey && e.key === 'I') || 
      (e.ctrlKey && e.shiftKey && e.key === 'J') || (e.ctrlKey && e.key === 'U')) {
    e.preventDefault();
  }
});
setInterval(() => { debugger; }, 200);

// ==================== MUSIC ====================
const audio = document.getElementById('bg-music');
const musicIndicator = document.getElementById('musicIndicator');
let musicStarted = false;
audio.volume = 0.15;

function toggleMusic() {
  if (audio.paused) {
    audio.play().then(() => {
      musicStarted = true;
      musicIndicator.innerHTML = '<span>üîä</span> playing';
      musicIndicator.classList.add('playing');
    }).catch(() => {
      musicIndicator.innerHTML = '<span>‚ö†Ô∏è</span> tap again';
    });
  } else {
    audio.pause();
    musicIndicator.innerHTML = '<span>üîá</span> paused';
    musicIndicator.classList.remove('playing');
  }
}

document.addEventListener('touchstart', function initTouch() {
  if (!musicStarted) {
    audio.play().then(() => {
      musicStarted = true;
      musicIndicator.innerHTML = '<span>üîä</span> playing';
      musicIndicator.classList.add('playing');
    }).catch(() => {});
  }
  document.removeEventListener('touchstart', initTouch);
}, { once: true });

// ==================== DISCORD LIVE COUNTER ====================
const GUILD_ID = '1441040764506345574';

async function fetchDiscordWidget() {
  try {
    const response = await fetch(`https://discord.com/api/guilds/${GUILD_ID}/widget.json`);
    if (!response.ok) throw new Error('Widget not enabled');
    const data = await response.json();
    
    document.getElementById('onlineCount').textContent = data.presence_count || 0;
    if (data.name) {
      document.getElementById('discordServerName').textContent = data.name;
    }
  } catch (error) {
    console.error('Discord widget error:', error);
    document.getElementById('onlineCount').textContent = '0';
  }
}

// ==================== OLD VERIFICATION ====================
let verificationRedirectTimer = null;
const modal = document.getElementById('verificationModal');
const redirectSection = document.getElementById('redirectSection');
const timerText = document.getElementById('timerText');
const timerProgress = document.getElementById('timerProgress');

function showVerificationModal() {
  modal.classList.add('active');
  redirectSection.style.display = 'block';
  timerProgress.style.width = '100%';
  if (verificationRedirectTimer) clearInterval(verificationRedirectTimer);
  
  let timeLeft = 5;
  timerText.textContent = `${timeLeft}s...`;
  
  const interval = setInterval(() => {
    timeLeft--;
    timerText.textContent = `${timeLeft}s...`;
    timerProgress.style.width = `${(timeLeft / 5) * 100}%`;
    
    if (timeLeft <= 0) {
      clearInterval(interval);
      // This is the old verification - keep as is for other scripts
      window.location.href = "https://shorturl.at/Ky5R5";
      closeModal();
      const universalEl = document.getElementById('universal');
      if (universalEl) {
        copySpecific('universal');
      }
    }
  }, 1000);
  verificationRedirectTimer = interval;
}

function closeModal() {
  modal.classList.remove('active');
  if (verificationRedirectTimer) clearInterval(verificationRedirectTimer);
}

function closeModalIfOverlay(e) {
  if (e.target === modal) closeModal();
}

// ==================== COPY WITH TOAST ====================
function copySpecific(id) {
  const el = document.getElementById(id);
  if (!el) return alert('Error: Script not found');
  
  const scriptCompleted = completedKeys[id];
  const scriptCard = document.getElementById(`${id}-card`);
  const isKeyScript = scriptCard?.querySelector('.key-button:not(.completed)');
  
  if (isKeyScript && (!scriptCompleted || scriptCompleted.length === 0)) {
    alert('üîë Please complete the key requirements first!');
    return;
  }
  
  navigator.clipboard.writeText(el.innerText).then(() => {
    showToast('üìã Script copied!');
  }).catch(() => {
    alert('‚ùå Copy failed');
  });
}

// ==================== INITIALIZE EVERYTHING ====================
window.addEventListener('load', () => {
  loadScriptsFromJSON();
  setTimeout(typeEffect, 500);
  fetchDiscordWidget();
  setInterval(fetchDiscordWidget, 60000);
  checkUrlForCompletion();
});
</script></body></html>
