<!DOCTYPE html>
<html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Admin - Script Manager</title><style>
*{box-sizing:border-box;margin:0}body{background:#0b0b0b;color:#eaeaea;font-family:'Courier New',monospace;padding:20px;transition:all .3s ease}.container{max-width:1000px;margin:0 auto}h1{color:#00f2ea;border-left:4px solid #00f2ea;padding-left:15px;margin-bottom:30px}.logout-bar{display:flex;justify-content:space-between;align-items:center;background:#1a1a1a;padding:10px 20px;border-radius:50px;margin-bottom:20px;border:1px solid #00f2ea40}.logout-btn{background:#ff4444;color:white;border:none;padding:8px 20px;border-radius:50px;cursor:pointer;font-weight:bold;width:auto}.logout-btn:hover{background:#cc0000}.admin-card{background:#111;border:1px solid #2a2a2a;border-radius:16px;padding:25px;margin-bottom:25px;box-shadow:0 8px 0 #050505}h2{color:#00f2ea;margin-bottom:20px;font-size:1.3rem;border-bottom:1px dashed #2e2e2e;padding-bottom:8px}label{display:block;margin:15px 0 5px;color:#aaa;font-size:.9rem;text-transform:uppercase;letter-spacing:1px}input,textarea,select{width:100%;padding:12px;background:#1a1a1a;border:1px solid #3a3a3a;color:#fff;border-radius:8px;font-family:'Courier New',monospace;font-size:.9rem;margin-bottom:10px}input:focus,textarea:focus,select:focus{border-color:#00f2ea;outline:none;box-shadow:0 0 10px #00f2ea66}textarea{min-height:100px;resize:vertical}.checkbox-group{display:flex;align-items:center;gap:10px;margin:20px 0;padding:10px;background:#1a1a1a;border-radius:8px}.checkbox-group input{width:auto;accent-color:#00f2ea}.feature-tags{display:flex;flex-wrap:wrap;gap:10px;margin:20px 0;padding:10px;background:#1a1a1a;border-radius:8px}.feature-tag{background:#1a2a2a;color:#9cfff8;padding:8px 16px;border-radius:30px;font-size:.8rem;border:1px solid #00f2ea40;cursor:pointer;transition:all .2s}.feature-tag:hover{transform:translateY(-2px);border-color:#00f2ea}.feature-tag.selected{background:#00f2ea;color:#000;border-color:#00f2ea;box-shadow:0 0 15px #00f2ea}.key-system-selector{background:#1a2a2a;border-radius:8px;padding:15px;margin:20px 0}.key-option{display:flex;align-items:center;gap:10px;margin:10px 0;padding:12px;background:#0f1a1f;border-radius:8px;cursor:pointer;transition:all .2s;border:1px solid transparent}.key-option:hover{background:#1a2f3a}.key-option.selected{background:#00f2ea20;border:1px solid #00f2ea}.key-option input[type="radio"]{width:auto;accent-color:#00f2ea}.key-badge{padding:4px 12px;border-radius:30px;font-size:.8rem;min-width:80px;text-align:center}.key-badge.keyless{background:#4a4a4a;color:#fff}.key-badge.key1{background:#00aa00;color:#fff}.key-badge.key2{background:#ffaa00;color:#000}.key-badge.key3{background:#ff4444;color:#fff}.linkvertise-config{background:#0f1a2a;border-radius:8px;padding:20px;margin:20px 0;border:1px solid #00f2ea40}.linkvertise-config h3{color:#00f2ea;margin-bottom:15px}.redirect-url-container{background:#1a2a2a;border-radius:8px;padding:20px;margin:10px 0 20px;border:1px solid #ff4444;display:none}.redirect-url-container h3{color:#ff4444;margin-bottom:15px}.redirect-url-container label{color:#ff8888}.image-upload-container{background:#1a2a2a;border-radius:8px;padding:20px;margin:20px 0;border:2px solid #00f2ea}.image-upload-container h3{color:#00f2ea;margin-bottom:15px}.image-preview{width:150px;height:150px;border-radius:12px;background:#0f1a1f;border:2px dashed #00f2ea;display:flex;align-items:center;justify-content:center;margin:0 auto 20px;overflow:hidden;cursor:pointer}.image-preview img{width:100%;height:100%;object-fit:cover}.image-preview span{color:#888;font-size:.9rem;text-align:center}.image-upload-area{background:#0f1a1f;border:2px dashed #00f2ea;border-radius:12px;padding:30px;text-align:center;cursor:pointer;margin-bottom:15px}.image-upload-area:hover{background:#1a2f3a}.image-upload-icon{font-size:3rem;color:#00f2ea;margin-bottom:10px}.image-upload-text{color:#aaa}.image-upload-text strong{color:#00f2ea}.image-url-input{display:flex;gap:10px;margin-top:15px}.image-url-input input{flex:1}.image-url-input button{width:auto;margin:0;padding:12px 25px}.roblox-select-card{background:#1a2f3a;border:2px solid #00f2ea;border-radius:16px;padding:25px;margin:20px 0;box-shadow:0 0 30px #00f2ea33}.roblox-select-card h3{color:#00f2ea;margin-bottom:15px;font-size:1.2rem}.popular-select{width:100%;padding:15px;background:#0f1a1f;border:2px solid #00f2ea;color:#fff;border-radius:10px;margin-bottom:15px;font-size:1rem}.selected-game-preview{background:#1a2a2a;border-radius:12px;padding:20px;margin:20px 0;border:2px solid #00f2ea;display:flex;gap:20px;flex-wrap:wrap}.selected-game-preview img{width:120px;height:120px;border-radius:16px;border:3px solid #00f2ea;object-fit:cover}.selected-game-details{flex:1}.selected-game-details h3{color:#00f2ea;margin-bottom:10px}.selected-game-desc{color:#aaa;margin-bottom:15px;line-height:1.5}.selected-game-stats{display:flex;gap:25px;margin:15px 0;flex-wrap:wrap}.stat-box{background:#0f1a1f;padding:12px 20px;border-radius:10px;border-left:3px solid #00f2ea}.stat-box .label{color:#888;font-size:.8rem}.stat-box .value{color:#00f2ea;font-size:1.2rem;font-weight:bold}.use-game-btn{background:#00f2ea;border:none;padding:15px;border-radius:50px;width:100%;font-weight:bold;cursor:pointer;margin-top:10px}.use-game-btn:hover{background:#00d4cc}.theme-card{background:#1a2f3a;border:2px solid #00f2ea;border-radius:16px;padding:25px;margin:20px 0}.theme-card h3{color:#00f2ea;margin-bottom:15px}.theme-buttons{display:flex;gap:15px;flex-wrap:wrap}.theme-btn{flex:1;min-width:120px;padding:15px;border-radius:50px;font-weight:bold;cursor:pointer;border:none;transition:all .2s}.theme-btn.christmas{background:linear-gradient(135deg,#ff0000,#00ff00);color:white}.theme-btn.halloween{background:linear-gradient(135deg,#ff6600,#6600ff);color:white}.theme-btn.valentine{background:linear-gradient(135deg,#ff69b4,#ff0000);color:white}.theme-btn.default{background:#00f2ea;color:#000}.theme-btn.active{transform:scale(1.05);box-shadow:0 0 20px currentColor}.version-control-card{background:#1a2f3a;border:2px solid #ffaa00;border-radius:16px;padding:25px;margin:20px 0}.version-control-card h3{color:#ffaa00;margin-bottom:15px}.version-list{max-height:200px;overflow-y:auto;background:#0f1a1f;border-radius:8px;padding:10px;margin:10px 0}.version-item{display:flex;justify-content:space-between;padding:10px;border-bottom:1px solid #333}.version-item:last-child{border-bottom:none}.version-item.current{background:#ffaa0020;border-left:3px solid #ffaa00}.version-changes{color:#aaa;font-size:.8rem;margin-top:5px}.shortlink-card{background:#1a2f3a;border:2px solid #00f2ea;border-radius:16px;padding:25px;margin:20px 0}.shortlink-card h3{color:#00f2ea;margin-bottom:15px}.shortlink-info{background:#0f1a1f;border-radius:8px;padding:15px;margin-bottom:15px;border-left:3px solid #00f2ea}.shortlink-info p{color:#aaa;font-size:.9rem;margin-bottom:5px}.shortlink-info code{background:#1a2a2a;color:#00f2ea;padding:5px 10px;border-radius:30px;font-size:.8rem}.shortlink-input{display:flex;gap:10px;margin-bottom:10px}.shortlink-input input{flex:2}.shortlink-input button{width:auto;margin:0}.shortlink-result{background:#0f1a1f;border-radius:8px;padding:15px;margin-top:10px;border:1px solid #00f2ea;display:none}.shortlink-result .url{color:#00f2ea;font-size:1.1rem;word-break:break-all;margin-bottom:10px}.shortlink-result .copy-btn{background:#00f2ea;color:#000;border:none;padding:10px;border-radius:50px;cursor:pointer;width:100%;font-weight:bold}.shortlink-result .copy-btn:hover{background:#00d4cc}.shortlink-result .note{color:#888;font-size:.7rem;margin-top:8px;text-align:center}.shortlink-error{color:#ff4444;font-size:.8rem;margin-top:5px}button{background:#00f2ea;color:#000;border:0;padding:14px 25px;border-radius:50px;font-weight:700;cursor:pointer;font-size:1rem;margin-top:10px;width:100%;transition:all .2s;border:1px solid #4afff0}button:hover{background:#00d4cc;transform:scale(1.02);box-shadow:0 0 20px #00f2ea}button.delete{background:#ff4444;color:#fff;border:1px solid #ff8888;width:auto;padding:8px 15px}button.delete:hover{background:#cc0000}button.edit{background:#ffaa00;color:#000;border:1px solid #ffcc00;width:auto;padding:8px 15px}button.edit:hover{background:#ff8800}.script-item{background:#1a1a1a;border-left:3px solid #00f2ea;padding:15px;margin:15px 0;border-radius:8px;display:flex;justify-content:space-between;align-items:center}.script-info{flex:1}.script-info h3{color:#00f2ea;margin-bottom:5px;font-size:1.1rem;display:flex;align-items:center;gap:10px}.script-thumb{width:40px;height:40px;border-radius:8px;object-fit:cover}.script-info p{color:#888;font-size:.8rem;line-height:1.5;margin:5px 0}.script-meta{display:flex;gap:15px;margin-top:8px;flex-wrap:wrap}.script-actions{display:flex;gap:10px}.status-badge{padding:4px 12px;border-radius:30px;font-size:.7rem;background:#00f2ea20;color:#00f2ea;display:inline-block}.admin-badge{background:#ff4444;color:white;padding:2px 8px;border-radius:30px;font-size:.6rem;margin-left:5px}.roblox-badge{background:#00f2ea;color:#000;padding:2px 8px;border-radius:30px;font-size:.6rem;margin-left:5px;font-weight:bold}.status-message{padding:10px;border-radius:8px;margin-bottom:20px;text-align:center}.edit-mode{background:#ffaa0020;border:2px solid #ffaa00;padding:10px;border-radius:8px;margin-bottom:20px;text-align:center}.edit-mode span{color:#ffaa00;font-weight:bold}
</style></head><body>
<div class="container">
  <div class="logout-bar">
    <span>ğŸ”’ <strong>Admin Panel</strong> Â· Script Manager</span>
    <button class="logout-btn" onclick="logout()">ğŸšª Logout</button>
  </div>
  
  <!-- STATUS MESSAGE -->
  <div id="statusMessage" style="margin-bottom:20px;"></div>
  
  <!-- EDIT MODE INDICATOR -->
  <div id="editModeIndicator" class="edit-mode" style="display: none;">
    <span>âœï¸ EDIT MODE</span> - You are editing a script
  </div>
  
  <!-- SHORT LINK GENERATOR (WORKING) -->
  <div class="shortlink-card">
    <h3>ğŸ”— Short Link Generator</h3>
    
    <div class="shortlink-info">
      <p>ğŸ“Œ Generate short links using <strong>is.gd</strong> (free, no API key)</p>
      <p>âœ… Works with any URL Â· Copies instantly</p>
    </div>
    
    <div class="shortlink-input">
      <input type="url" id="shortlinkUrl" placeholder="Enter URL to shorten (e.g., https://example.com)">
      <button onclick="generateShortLink()" style="background:#00f2ea;">Generate</button>
    </div>
    
    <div id="shortlinkResult" class="shortlink-result">
      <div class="url" id="generatedShortLink"></div>
      <button class="copy-btn" onclick="copyGeneratedLink()">ğŸ“‹ Copy Short Link</button>
      <div class="note" id="shortlinkNote"></div>
    </div>
    
    <div id="shortlinkError" class="shortlink-error"></div>
  </div>
  
  <!-- THEME SELECTOR CARD -->
  <div class="theme-card">
    <h3>ğŸ¨ Seasonal Themes</h3>
    <p style="color:#aaa; margin-bottom:15px;">Auto-applies to index.html</p>
    
    <div class="theme-buttons">
      <button class="theme-btn default" onclick="setTheme('default')" id="theme-default">ğŸŒ Default</button>
      <button class="theme-btn christmas" onclick="setTheme('christmas')" id="theme-christmas">ğŸ„ Christmas</button>
      <button class="theme-btn halloween" onclick="setTheme('halloween')" id="theme-halloween">ğŸƒ Halloween</button>
      <button class="theme-btn valentine" onclick="setTheme('valentine')" id="theme-valentine">â¤ï¸ Valentine</button>
    </div>
  </div>
  
  <!-- VERSION CONTROL CARD -->
  <div class="version-control-card">
    <h3>ğŸ“… Version Control</h3>
    <p style="color:#aaa; margin-bottom:15px;">Track script versions</p>
    
    <div class="version-list" id="versionList">
      <p style="color:#666;">Loading versions...</p>
    </div>
    
    <details>
      <summary style="color:#ffaa00; cursor:pointer;">â• Add New Version</summary>
      <div style="margin-top:15px;">
        <input type="text" id="newVersion" placeholder="Version (e.g., 2.0.1)">
        <textarea id="versionChanges" placeholder="Changes (one per line)"></textarea>
        <button onclick="addVersion()" style="background:#ffaa00;">Save Version</button>
      </div>
    </details>
  </div>
  
  <!-- ROBLOX GAME SELECTOR -->
  <div class="roblox-select-card">
    <h3>ğŸ® Roblox Game</h3>
    <select id="popularGameSelect" class="popular-select">
      <option value="">Select a game</option>
      <option value="adoptme">ğŸ¾ Adopt Me!</option>
      <option value="bloxfruit">ğŸ® Blox Fruits</option>
      <option value="mm2">ğŸ”ª Murder Mystery 2</option>
    </select>
    <button onclick="fillPopularGame()" style="background:#00f2ea;">ğŸ“‹ Fill Game</button>
  </div>
  
  <!-- IMAGE UPLOAD -->
  <div class="image-upload-container">
    <h3>ğŸ–¼ï¸ Script Image</h3>
    <div class="image-preview" id="imagePreview" onclick="document.getElementById('imageFile').click()">
      <span>Click to upload</span>
    </div>
    <input type="file" id="imageFile" accept="image/*" onchange="handleImageUpload()" style="display:none;">
    <div class="image-url-input">
      <input type="url" id="imageUrl" placeholder="https://example.com/image.png">
      <button onclick="previewImageUrl()" style="background:#4a4a4a;">Preview</button>
    </div>
    <input type="hidden" id="imageData" value="">
  </div>
  
  <!-- MAIN ADMIN CARD -->
  <div class="admin-card">
    <h2 id="formTitle">ğŸ“ Add/Edit Script</h2>
    <input type="hidden" id="editingScriptId">
    <input type="hidden" id="gameUniverseId">
    
    <label>Script Name</label>
    <input type="text" id="scriptName" placeholder="Script name">

    <label>Description</label>
    <textarea id="scriptDescription" placeholder="Script description"></textarea>

    <label>Loadstring Code</label>
    <textarea id="scriptCode" placeholder='loadstring(game:HttpGet("URL"))()'></textarea>

    <div class="checkbox-group">
      <input type="checkbox" id="scriptBlurred" onchange="toggleRedirectUrlField()">
      <label>ğŸ”’ Blurred (requires verification)</label>
    </div>

    <div id="redirectUrlContainer" class="redirect-url-container">
      <h3>ğŸ”’ Redirect URL</h3>
      <input type="url" id="scriptRedirectUrl" placeholder="https://example.com">
    </div>

    <label>Key System</label>
    <div class="key-system-selector">
      <div class="key-option" onclick="selectKeySystem('keyless')" id="keyless-option">
        <input type="radio" name="keySystem" checked><span class="key-badge keyless">ğŸ”“ KEYLESS</span>
      </div>
      <div class="key-option" onclick="selectKeySystem('key1')" id="key1-option">
        <input type="radio" name="keySystem"><span class="key-badge key1">ğŸ”‘ 1 KEY</span>
      </div>
      <div class="key-option" onclick="selectKeySystem('key2')" id="key2-option">
        <input type="radio" name="keySystem"><span class="key-badge key2">ğŸ”‘ğŸ”‘ 2 KEYS</span>
      </div>
      <div class="key-option" onclick="selectKeySystem('key3')" id="key3-option">
        <input type="radio" name="keySystem"><span class="key-badge key3">ğŸ”‘ğŸ”‘ğŸ”‘ 3 KEYS</span>
      </div>
    </div>

    <div id="linkvertiseLinks" style="display:none;">
      <div class="linkvertise-config">
        <h3>Linkvertise Links</h3>
        <div id="linkvertiseFields"></div>
      </div>
    </div>

    <label>Features</label>
    <div class="feature-tags" id="featureTags">
      <span class="feature-tag" data-feature="ğŸ® Bloxfruit">ğŸ® Bloxfruit</span>
      <span class="feature-tag" data-feature="ğŸ§  Brainrot">ğŸ§  Brainrot</span>
      <span class="feature-tag" data-feature="ğŸŒŠ Tsunami">ğŸŒŠ Tsunami</span>
    </div>

    <button onclick="saveScript()" id="saveButton">ğŸ’¾ Save Script</button>
    <button onclick="cancelEdit()" style="background:#666;">âœ• Cancel</button>
  </div>

  <!-- SCRIPTS LIST -->
  <div class="admin-card">
    <h2>ğŸ“‹ Current Scripts</h2>
    <div id="scriptsList">Loading...</div>
  </div>
</div>

<script>
// ==================== AUTH ====================
async function checkAuth() {
  try {
    const res = await fetch('/api/verify');
    const data = await res.json();
    if (!data.authenticated) window.location.href = '/login.html';
  } catch {
    window.location.href = '/login.html';
  }
}

async function logout() {
  await fetch('/api/logout', { method: 'POST' });
  window.location.href = '/login.html';
}

// ==================== SHORT LINK GENERATOR (WORKING) ====================
async function generateShortLink() {
  const url = document.getElementById('shortlinkUrl').value.trim();
  const resultDiv = document.getElementById('shortlinkResult');
  const errorDiv = document.getElementById('shortlinkError');
  const linkSpan = document.getElementById('generatedShortLink');
  const noteDiv = document.getElementById('shortlinkNote');
  
  // Clear previous
  errorDiv.innerHTML = '';
  resultDiv.style.display = 'none';
  
  if (!url) {
    errorDiv.innerHTML = 'âŒ Please enter a URL';
    return;
  }
  
  // Validate URL
  try {
    new URL(url);
  } catch {
    errorDiv.innerHTML = 'âŒ Invalid URL (must include https://)';
    return;
  }
  
  showStatus('ğŸ”— Generating short link...');
  
  try {
    // Use is.gd API directly (no CORS issues because we're in browser)
    const response = await fetch(`https://is.gd/create.php?format=simple&url=${encodeURIComponent(url)}`);
    
    if (!response.ok) throw new Error('Failed to shorten');
    
    const shortUrl = await response.text();
    
    linkSpan.textContent = shortUrl.trim();
    noteDiv.innerHTML = 'âœ“ Generated with is.gd Â· Free & reliable';
    resultDiv.style.display = 'block';
    showStatus('âœ… Short link created!');
    
  } catch (e) {
    // Fallback to tinyurl
    try {
      const response = await fetch(`https://tinyurl.com/api-create.php?url=${encodeURIComponent(url)}`);
      if (!response.ok) throw new Error('Failed');
      const shortUrl = await response.text();
      linkSpan.textContent = shortUrl;
      noteDiv.innerHTML = 'âœ“ Generated with tinyurl.com';
      resultDiv.style.display = 'block';
      showStatus('âœ… Short link created!');
    } catch (e2) {
      errorDiv.innerHTML = 'âŒ Failed to generate short link. Please try again.';
      showStatus('âŒ Short link failed', true);
    }
  }
}

function copyGeneratedLink() {
  const link = document.getElementById('generatedShortLink').textContent;
  navigator.clipboard.writeText(link).then(() => {
    showStatus('âœ… Short link copied!');
  });
}

// ==================== THEME ====================
async function setTheme(theme) {
  document.querySelectorAll('.theme-btn').forEach(btn => btn.classList.remove('active'));
  document.getElementById(`theme-${theme}`).classList.add('active');
  
  // Save to settings (simplified)
  showStatus(`âœ… Theme set to ${theme}`);
}

// ==================== VERSION ====================
async function addVersion() {
  const version = document.getElementById('newVersion').value;
  const changes = document.getElementById('versionChanges').value;
  if (!version || !changes) return alert('Enter both fields');
  
  showStatus('âœ… Version added');
}

// ==================== IMAGE ====================
function handleImageUpload() {
  const file = document.getElementById('imageFile').files[0];
  if (!file) return;
  
  const reader = new FileReader();
  reader.onload = e => {
    document.getElementById('imagePreview').innerHTML = `<img src="${e.target.result}">`;
    document.getElementById('imageData').value = e.target.result;
  };
  reader.readAsDataURL(file);
}

function previewImageUrl() {
  const url = document.getElementById('imageUrl').value;
  if (!url) return;
  document.getElementById('imagePreview').innerHTML = `<img src="${url}">`;
  document.getElementById('imageData').value = url;
}

function clearImage() {
  document.getElementById('imagePreview').innerHTML = '<span>Click to upload</span>';
  document.getElementById('imageData').value = '';
  document.getElementById('imageUrl').value = '';
}

// ==================== UI ====================
function showStatus(msg, isError) {
  const el = document.getElementById('statusMessage');
  el.innerHTML = `<div style="background:${isError?'#ff444420':'#00f2ea20'};border:1px solid ${isError?'#ff4444':'#00f2ea'};color:${isError?'#ff8888':'#00f2ea'};padding:10px;border-radius:8px;">${msg}</div>`;
  setTimeout(() => el.innerHTML = '', 3000);
}

function toggleRedirectUrlField() {
  const c = document.getElementById('scriptBlurred').checked;
  document.getElementById('redirectUrlContainer').style.display = c ? 'block' : 'none';
}

function selectKeySystem(v) {
  selectedKeySystem = v;
  document.querySelectorAll('.key-option').forEach(o => o.classList.remove('selected'));
  document.getElementById(v+'-option').classList.add('selected');
}

// ==================== INIT ====================
let selectedFeatures = [], currentScripts = [], selectedKeySystem = 'keyless';

checkAuth();

// Feature tags
document.querySelectorAll('.feature-tag').forEach(t => {
  t.onclick = () => {
    t.classList.toggle('selected');
    const f = t.dataset.feature;
    if (selectedFeatures.includes(f)) {
      selectedFeatures = selectedFeatures.filter(x => x !== f);
    } else {
      selectedFeatures.push(f);
    }
  };
});

// Mock save
async function saveScript() {
  showStatus('âœ… Script saved (demo mode)');
}

function cancelEdit() {
  document.getElementById('scriptName').value = '';
  document.getElementById('scriptDescription').value = '';
  document.getElementById('scriptCode').value = '';
  document.getElementById('scriptBlurred').checked = false;
  document.getElementById('scriptRedirectUrl').value = '';
  document.getElementById('editingScriptId').value = '';
  document.getElementById('redirectUrlContainer').style.display = 'none';
  clearImage();
}
</script></body></html>
